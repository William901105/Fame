<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
        <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
        <meta name="viewport" content="width=device-width" />
    
        <title>FAME - Login</title>
    
        <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    
        {# <!-- Bootstrap core CSS     -->
        <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />

        <!-- Template CSS -->
        <link href="{{ url_for('static', filename='css/template.css') }}" rel="stylesheet"/>

        <!-- Animation -->
        <link href="{{ url_for('static', filename='css/animate.css') }}" rel="stylesheet"/>

        <!-- FAME CSS -->
        <link href="{{ url_for('static', filename='css/fame.css') }}" rel="stylesheet" />

        <!--     Fonts and icons     -->
        <link href="{{ url_for('static', filename='css/font-awesome.min.css')}}" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
        <link href="{{ url_for('static', filename='css/pe-icon-7-stroke.css')}}" rel="stylesheet" />

        <!-- Highlight Theme -->
        <link href="{{ url_for('static', filename='css/highlight.railscasts.min.css')}}" rel="stylesheet" />

        <!--   Core JS Files   -->
        <script src="{{ url_for('static', filename='js/jquery-1.11.3.min.js') }}" type="text/javascript"></script>
        <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}" type="text/javascript"></script>

        <!-- Template JS -->
        <script src="{{ url_for('static', filename='js/template.js') }}"></script>
        <script src="{{ url_for('static', filename='js/checkbox.js') }}"></script>

        <!-- Bootstrap Notifications -->
        <script src="{{ url_for('static', filename='js/bootstrap-notify.min.js') }}"></script>

        <!-- FAME JS -->
        <script src="{{ url_for('static', filename='js/fame.js') }}"></script>

        <!-- File inputs -->
        <link href="{{ url_for('static', filename='css/fileinput.min.css') }}" rel="stylesheet" />
        <script src="{{ url_for('static', filename='js/fileinput.min.js') }}"></script>

        <!-- Highlight JS -->
        <script src="{{ url_for('static', filename='js/highlight.min.js') }}"></script>

        <!-- Tags Input -->
        <script src="{{ url_for('static', filename='js/tagsinput.js') }}"></script>

        <!-- Flexdatalist -->
        <link href="{{ url_for('static', filename='css/jquery.flexdatalist.min.css') }}" rel="stylesheet" />
        <script src="{{ url_for('static', filename='js/jquery.flexdatalist.min.js') }}"></script>

        <!-- Handlebars -->
        <script src="{{ url_for('static', filename='js/handlebars.min.js') }}"></script> #}
        
        <!-- Figma -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/globals.css')}}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styleguide.css')}}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css')}}">
        {# <script type="text/javascript" src="{{ url_for('static', filename='js/fame.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.11.3.min.js') }}"></script> #}
    </head>
    <body class="flex-all fillfill fal-h7">
        
        <div class="fillfix fal-v8 menu">
            <div class="hugfix fal-h5 head">
                <p class="fal-h5 font-fame">FAME</p>
            </div>
            <div class="fillfill fal-v8 content">

                <div class="hugfill fal-v7 options">
                    <a class="fixfill fal-h4" href="{{ url_for('PreprocessorsView:index') }}">
                        <p class="font-mn-opt">Preprocessors</p>
                    </a>
                    {% if current_user.has_permission('configs') %}
                    <a class="fixfill fal-h4" href="{{ url_for('ConfigsView:index') }}">
                        <p class="font-mn-opt">Configs</p>
                    </a>
                    {% endif %}
                    <a class="fixfill fal-h4" href="{{ url_for('FilesView:index') }}">
                        <p class="font-mn-opt">Objects</p>
                    </a>
                    <a class="fixfill fal-h4 current" href="{{ url_for('AnalysesView:index') }}">
                        <p class="font-mn-opt">Analyses</p>
                    </a>
                    <a class="fixfill fal-h4" href="{{ url_for('AnalysesView:new') }}">
                        <p class="font-mn-opt">Submit</p>
                    </a>
                </div>

                <div class="hugfill fal-v8 recent-analyses">

                    <div class="hugfill fal-h5"><p class="font-sec-header">Recent Analyses</p></div>
                    <div class="hugfill fal-v8 histories">
                        {% for analysis in g.last_analyses %}
                            <a class="fixfill fal-h5" href="{{ url_for('AnalysesView:get', id=analysis._id) }}">
                                {% if analysis.status == 'finished' %}
                                    {% include "includes/icons/CheckMark.html" %}
                                {% elif analysis.status == 'pending' %}
                                    {% include "includes/icons/Clock.html" %}
                                {% elif analysis.status in ('running', 'preloading') %}
                                    {% include "includes/icons/Refresh.html" %}
                                {% elif analysis.status == 'error' %}
                                    {% include "includes/icons/Error.html" %}
                                {% endif %}
                                <p class="font-hash-value">
                                    {% if not analysis.file.type == 'url' %}{{analysis.file.md5}}{% endif %}
                                </p>
                                {% include "includes/icons/ExternalPrompt.html" %}                                
                            </a>
                        {% endfor %}
                    </div>

                </div>
            </div>
        </div>


        <div class="fillfill fal-v8 main">

            <div class="hugfill fal-h5 head">
                <form role="search" action="{{ url_for('SearchView:post') }}" method="post" class="hugfill fal-h5 head-frame">
                    <input type="text" name="query" value="" class="fillfill fal-h4 search font-sec-header" placeholder="Search..">
                    
                    <button type="button" class="hughug avatar" onclick="
                        this.nextElementSibling.classList.toggle('collapsed');
                        ">
                        <img src="{{current_user._id|avatar}}" />
                    </button>
                    <div class="fal-v8 hugfix avatar-menu collapsed">
                        {% if not current_user.is_guest(current_user._id) %}
                        <a class="fixfill fal-h4" href="{{url_for('UsersView:get', id=current_user._id)}}">
                            <p class="font-mn-opt">Profile</p>
                        </a>
                        {% endif %}
                        {% if current_user.has_permission('manage_modules') %}
                        <a class="fixfill fal-h4" href="{{ url_for('ModulesView:index') }}">
                            <p class="font-mn-opt">Configuration</p>
                        </a>
                        {% endif %}
                        {% if current_user.has_permission('manage_users') %}
                        <a class="fixfill fal-h4" href="{{ url_for('UsersView:index') }}">
                            <p class="font-mn-opt">Users</p>
                        </a>
                        {% endif %}
                        <a class="fixfill fal-h4" href="/logout">
                            <p class="font-mn-opt">Logout</p>
                        </a>
                    </div>

                </form>
            </div>

            <div class="hugfill fal-v8 content">
                <p class="font-main-title">Preprocess</p>
            </div>

        </div>

        {# TODO #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <script>
                    {% for category, message in messages %}

                        {% if category != "persistent" %}
                            {% if category == "message" %}
                                var category = "info";
                            {% else %}
                                var category = "{{category}}";
                            {% endif %}

                                $.notify(
                                    {message: "{{message}}"},
                                    {offset: {y: 50, x: 30}, type: category});
                        {% endif %}
                    {% endfor %}
                </script>
            {% endif %}
        {% endwith %}
    </body>
</html>
